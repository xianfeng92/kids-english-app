<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ³é¢‘æµ‹è¯• - DUDU English</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 { text-align: center; color: #333; margin-bottom: 20px; }
    .test-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    .test-btn {
      padding: 15px;
      background: #f0f0f0;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      text-align: center;
      font-weight: bold;
      transition: all 0.3s;
    }
    .test-btn:hover {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    .test-btn.playing {
      background: #28a745;
      color: white;
      border-color: #28a745;
      animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .status {
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-top: 20px;
      font-family: monospace;
      font-size: 12px;
    }
    .status-line {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    .status-line.success { color: #28a745; }
    .status-line.error { color: #dc3545; }
    .status-line.info { color: #17a2b8; }
    .mode-toggle {
      text-align: center;
      margin-bottom: 20px;
    }
    .mode-btn {
      padding: 10px 20px;
      margin: 0 5px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .mode-btn.active {
      background: #28a745;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”Š éŸ³é¢‘æ’­æŠ¥æµ‹è¯•</h1>

    <div class="mode-toggle">
      <button class="mode-btn active" id="devMode" onclick="setMode('dev')">å¼€å‘æ¨¡å¼ (/audio/)</button>
      <button class="mode-btn" id="prodMode" onclick="setMode('prod')">ç”Ÿäº§æ¨¡å¼ (/kids-english-app/audio/)</button>
    </div>

    <div class="test-grid" id="testGrid"></div>

    <div class="status" id="status">
      <div class="status-line info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•éŸ³é¢‘æ’­æ”¾...</div>
    </div>
  </div>

  <script>
    const testWords = [
      { text: 'Apple', emoji: 'ğŸ' },
      { text: 'Cat', emoji: 'ğŸ±' },
      { text: 'Dog', emoji: 'ğŸ¶' },
      { text: 'Happy', emoji: 'ğŸ˜Š' },
      { text: 'Sun', emoji: 'â˜€ï¸' },
      { text: 'Red', emoji: 'ğŸ”´' },
      { text: 'Hello world', emoji: 'ğŸ‘‹' },
      { text: 'Good morning', emoji: 'ğŸŒ…' },
      { text: 'I love you', emoji: 'â¤ï¸' },
    ];

    let currentMode = 'dev';
    const BASE_PATHS = {
      dev: '/audio/',
      prod: '/kids-english-app/audio/'
    };

    function setMode(mode) {
      currentMode = mode;
      document.getElementById('devMode').classList.toggle('active', mode === 'dev');
      document.getElementById('prodMode').classList.toggle('active', mode === 'prod');
      addStatus(`åˆ‡æ¢åˆ° ${mode === 'dev' ? 'å¼€å‘' : 'ç”Ÿäº§'} æ¨¡å¼: ${BASE_PATHS[mode]}`, 'info');
    }

    function getAudioPath(text) {
      const filename = text.toLowerCase().replace(/\s+/g, '_').replace(/[^\w_]/g, '') + '.mp3';
      return BASE_PATHS[currentMode] + filename;
    }

    function addStatus(message, type = 'info') {
      const status = document.getElementById('status');
      const line = document.createElement('div');
      line.className = `status-line ${type}`;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      status.insertBefore(line, status.firstChild);
      // åªä¿ç•™æœ€è¿‘ 10 æ¡
      while (status.children.length > 10) {
        status.removeChild(status.lastChild);
      }
    }

    function playAudio(text, btn) {
      const audioPath = getAudioPath(text);
      addStatus(`å°è¯•æ’­æ”¾: ${audioPath}`, 'info');

      btn.classList.add('playing');

      const audio = new Audio(audioPath);

      audio.onplay = () => {
        addStatus(`âœ“ æ­£åœ¨æ’­æ”¾æœ¬åœ°éŸ³é¢‘: "${text}"`, 'success');
      };

      audio.onended = () => {
        addStatus(`âœ“ æ’­æ”¾å®Œæˆ: "${text}"`, 'success');
        btn.classList.remove('playing');
      };

      audio.onerror = (e) => {
        btn.classList.remove('playing');
        addStatus(`âœ— æœ¬åœ°éŸ³é¢‘å¤±è´¥ï¼Œå°è¯• Web Speech API: "${text}"`, 'error');
        // å›é€€åˆ° Web Speech API
        fallbackToWebSpeech(text, btn);
      };

      audio.play().catch((err) => {
        btn.classList.remove('playing');
        addStatus(`âœ— æ’­æ”¾å¤±è´¥: ${err.message}`, 'error');
        fallbackToWebSpeech(text, btn);
      });
    }

    function fallbackToWebSpeech(text, btn) {
      if ('speechSynthesis' in window) {
        addStatus(`ä½¿ç”¨ Web Speech API æ’­æ”¾: "${text}"`, 'info');
        btn.classList.add('playing');

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-GB';

        utterance.onend = () => {
          addStatus(`âœ“ Web Speech API æ’­æ”¾å®Œæˆ: "${text}"`, 'success');
          btn.classList.remove('playing');
        };

        utterance.onerror = (e) => {
          addStatus(`âœ— Web Speech API ä¹Ÿå¤±è´¥äº†: ${e}`, 'error');
          btn.classList.remove('playing');
        };

        window.speechSynthesis.speak(utterance);
      } else {
        addStatus(`âœ— æµè§ˆå™¨ä¸æ”¯æŒ Web Speech API`, 'error');
      }
    }

    // åˆå§‹åŒ–æµ‹è¯•æŒ‰é’®
    const grid = document.getElementById('testGrid');
    testWords.forEach(({ text, emoji }) => {
      const btn = document.createElement('div');
      btn.className = 'test-btn';
      btn.innerHTML = `${emoji}<br>${text}`;
      btn.onclick = () => playAudio(text, btn);
      grid.appendChild(btn);
    });

    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰æ¨¡å¼
    addStatus(`å½“å‰æ¨¡å¼: ${BASE_PATHS[currentMode]}`, 'info');
  </script>
</body>
</html>
